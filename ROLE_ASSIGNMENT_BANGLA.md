# ??? ????????????? ?????? - ?????? ?????? ?

## ????? ??????
JWT token ????? login ??? authenticate ?????, ?????? role assign ???? ???? error ??????

## ?? ??? ??????

### ?. AuthController ????? ??? ??????
- ? AssignRole endpoint ? better error handling
- ? Detailed logging ??? ??? ??????
- ? RemoveRole endpoint ??? ??? ??????
- ? GetUserById endpoint ??? ??? ??????
- ? TestAuth endpoint ??? ??? ??????

### ?. ???? Features
| Endpoint | ??? |
|----------|-----|
| `GET /api/auth/test-auth` | Token ??? ???? ???? test ??? |
| `GET /api/auth/users/{id}` | Specific user ?? details |
| `POST /api/auth/remove-role` | Role remove ??? |

---

## ??? ?????? ??????? ????? (Step by Step)

### ??? ?: Login ????
```
POST /api/auth/login
{
  "email": "swagger@example.com",
  "password": "Swagger123456789"
}
```

**Response ???? token copy ????**

### ??? ?: Swagger ? Authorize ????
1. **Authorize** button (??) click ????
2. ?????: `Bearer YOUR_TOKEN_HERE`
3. **Authorize** then **Close** click ????

### ??? ?: Test ???? token ??? ???? ????
```
GET /api/auth/test-auth
```

Should return your user info with claims.

### ??? ?: User list ?????
```
GET /api/auth/users
```

?? user ?? role ???? ??? ??? **id** copy ?????

### ??? ?: Role Assign ????
```
POST /api/auth/assign-role
{
  "userId": "PASTE_USER_ID_HERE",
"role": "Admin"
}
```

**Success Response:**
```json
{
  "success": true,
  "message": "Role 'Admin' assigned successfully...",
  "roles": ["Employee", "Admin"]
}
```

---

## ???? Role ???
- **Admin** - ?? ???? ???? ????
- **Manager** - Document ??? Leave approve ???? ????
- **HR** - Leave approve ???? ????
- **Reviewer** - Document review ???? ????
- **Employee** - Default role (???? ????)

---

## Error ??? ?? ?????

### Error: 401 Unauthorized
**????:** Token ??? ?? expired

**??????:**
1. ???? login ????
2. Swagger ? Authorize ????
3. Token ?????? `Bearer ` ????? ???? ????? ???? check ????

### Error: 403 Forbidden
**????:** ????? Admin role ???

**??????:** Database ? manually add ????:
```sql
DECLARE @UserId NVARCHAR(450) = 'YOUR_USER_ID';
DECLARE @AdminRole NVARCHAR(450) = (SELECT Id FROM AspNetRoles WHERE Name = 'Admin');

INSERT INTO AspNetUserRoles (UserId, RoleId) VALUES (@UserId, @AdminRole);
```

### Error: Role does not exist
**????:** Database ? role create ?????

**??????:** API restart ???? (automatic seed ???)

---

## Database Check ???? SQL

### ????? roles ?????
```sql
SELECT u.Email, r.Name as Role
FROM AspNetUsers u
JOIN AspNetUserRoles ur ON u.Id = ur.UserId
JOIN AspNetRoles r ON ur.RoleId = r.RoleId
WHERE u.Email = 'swagger@example.com';
```

### ?? roles ?????
```sql
SELECT * FROM AspNetRoles;
```

### ?? users ??? ????? roles
```sql
SELECT 
    u.Email,
    STRING_AGG(r.Name, ', ') as Roles
FROM AspNetUsers u
LEFT JOIN AspNetUserRoles ur ON u.Id = ur.UserId
LEFT JOIN AspNetRoles r ON ur.RoleId = r.RoleId
GROUP BY u.Email;
```

---

## Important Points

1. **Token validity:** 60 minutes (expire ??? ???? login ????)

2. **Bearer prefix:** ?????? ?????
   - ? `Bearer eyJhbGc...`
   - ? `eyJhbGc...`

3. **Role names case-sensitive:**
   - ? `Admin`
   - ? `admin`

4. **Default role:** Registration ? auto `Employee` role ????

5. **Multiple roles:** ???? user ?? ?????? role ????? ????

---

## Quick Test Commands

```bash
# 1. Login
POST /api/auth/login ? Get token

# 2. Authorize in Swagger
Click Authorize ? Paste: Bearer {token}

# 3. Test token
GET /api/auth/test-auth ? Should show your info

# 4. Get users  
GET /api/auth/users ? Copy userId

# 5. Assign role
POST /api/auth/assign-role
{
  "userId": "...",
  "role": "Manager"
}

# 6. Verify
GET /api/auth/users/{userId} ? Check roles array
```

---

## ?? ??? ??? ???? check ????

- ? API running ????
- ? Database ? roles ????
- ? ????? user ?? Admin role ????
- ? Token expire ??????
- ? Swagger ? Authorize ???????

**?? ? ??? role assignment ??? ????!**

---

## ???? Test ????!

1. **Swagger open ????:** https://localhost:5001/swagger
2. **Login ????:** swagger@example.com
3. **Authorize ????:** Token ?????
4. **Role assign ????:** ?????? user ??

**Build: ? Successful**  
**Status: ? Ready to Use**  
**Documentation: ? Complete**

---

**?????? ?????? ???? ????! ??? ??????? ?????** ??

_???? ?????? ??? API logs check ???? - ?????? detailed error messages ??????_
